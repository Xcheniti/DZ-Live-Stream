name: ğŸ“¡ Echorouk Stream Extractor

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'
  push:
    branches: [ main ]

jobs:
  extract-stream:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“¦ Install dependencies
      run: |
        pip install requests --no-cache-dir
    
    - name: ğŸ” Run extractor
      id: extract
      run: |
        echo "Starting extraction at $(date)"
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø£ÙˆÙ„Ø§Ù‹
        mkdir -p results
        mkdir -p logs
        
        # ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        python echorouk_extractor.py
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        if [ -f "results/echorouk.m3u" ]; then
          echo "status=success" >> $GITHUB_OUTPUT
          echo "has_file=true" >> $GITHUB_OUTPUT
        else
          echo "status=partial" >> $GITHUB_OUTPUT
          echo "has_file=false" >> $GITHUB_OUTPUT
        fi
        
        echo "Extraction finished at $(date)"
    
    - name: ğŸ“¤ Upload results
      uses: actions/upload-artifact@v4
      with:
        name: echorouk-stream
        path: |
          results/
          logs/
        retention-days: 3
    
    - name: ğŸ“ Display results
      run: |
        echo "=== EXTRACTION RESULTS ==="
        echo "Status: ${{ steps.extract.outputs.status }}"
        echo "Has M3U file: ${{ steps.extract.outputs.has_file }}"
        ls -la results/ || echo "No results directory"
        echo "=========================="
